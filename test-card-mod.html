<!DOCTYPE html>
<html>
<head>
  <title>TimeFlow Card - Card-mod Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
    }
    .pass { background: #e8f5e8; color: #2e7d2e; }
    .fail { background: #fee; color: #d63031; }
    timeflow-card {
      display: block;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>TimeFlow Card - Card-mod Integration Test</h1>
    
    <div id="test-results"></div>
    
    <h3>Test Card (with card-mod styling):</h3>
    <timeflow-card id="test-card"></timeflow-card>
    
    <h3>Expected Behavior:</h3>
    <ul>
      <li>Card should have a gradient background</li>
      <li>Border should be visible</li>
      <li>Title should be white with shadow</li>
      <li>Custom border radius should be applied</li>
    </ul>
  </div>

  <!-- Mock card-mod for testing -->
  <script>
    // Mock card-mod implementation for testing
    class MockCardMod extends HTMLElement {
      static applyToElement(element, type, config, variables, shadow, cls) {
        console.log('Card-mod applied:', { element, type, config, variables, shadow, cls });
        
        // Apply some basic styling to verify integration
        if (config && config.style) {
          const style = document.createElement('style');
          style.textContent = config.style;
          element.shadowRoot.appendChild(style);
          return true;
        }
        return false;
      }
    }
    
    customElements.define('card-mod', MockCardMod);
  </script>

  <!-- Load TimeFlow Card -->
  <script src="timeflow-card.js"></script>
  
  <script>
    // Test card-mod integration
    document.addEventListener('DOMContentLoaded', () => {
      const results = document.getElementById('test-results');
      const testCard = document.getElementById('test-card');
      
      function addResult(test, pass, message) {
        const div = document.createElement('div');
        div.className = `test-result ${pass ? 'pass' : 'fail'}`;
        div.textContent = `${pass ? '✓' : '✗'} ${test}: ${message}`;
        results.appendChild(div);
      }
      
      // Test 1: Card-mod class exists
      const cardModExists = customElements.get('card-mod');
      addResult('Card-mod Mock', !!cardModExists, cardModExists ? 'Available' : 'Not found');
      
      // Test 2: Configure the card with card-mod
      const config = {
        target_date: "2025-12-31T23:59:59",
        title: "Card-mod Test",
        card_mod: {
          style: `
            ha-card {
              background: linear-gradient(45deg, #1976d2, #42a5f5) !important;
              border: 2px solid #0d47a1 !important;
              border-radius: 20px !important;
              box-shadow: 0 4px 20px rgba(25, 118, 210, 0.3) !important;
            }
            .title {
              color: white !important;
              text-shadow: 1px 1px 2px rgba(0,0,0,0.5) !important;
            }
          `
        }
      };
      
      try {
        testCard.setConfig(config);
        addResult('Card Configuration', true, 'Successfully configured with card-mod');
        
        // Test 3: Check if _applyCardMod method exists
        const hasCardModMethod = typeof testCard._applyCardMod === 'function';
        addResult('Card-mod Method', hasCardModMethod, hasCardModMethod ? 'Method exists' : 'Method missing');
        
        // Test 4: Check if ha-card element is created
        setTimeout(() => {
          const haCard = testCard.shadowRoot.querySelector('ha-card');
          addResult('ha-card Element', !!haCard, haCard ? 'Created successfully' : 'Not found');
          
          // Test 5: Check if card-mod was applied
          setTimeout(() => {
            const haCard = testCard.shadowRoot.querySelector('ha-card');
            const hasCardMod = haCard && haCard.shadowRoot && haCard.shadowRoot.querySelector('style');
            addResult('Card-mod Applied', !!hasCardMod, hasCardMod ? 'Styles applied' : 'No styles found');
          }, 100);
        }, 100);
        
      } catch (error) {
        addResult('Card Configuration', false, error.message);
      }
    });
  </script>
</body>
</html>
