<!DOCTYPE html>
<html>
<head>
  <title>TimeFlow Card - Card-mod Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
    }
    .pass { background: #e8f5e8; color: #2e7d2e; }
    .fail { background: #fee; color: #d63031; }
    timeflow-card {
      display: block;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>TimeFlow Card - Enhanced Styling Test</h1>
    
    <div id="test-results"></div>
    
    <h3>Test 1: Card-mod styling (should work):</h3>
    <timeflow-card id="test-card-mod"></timeflow-card>
    
    <h3>Test 2: Native styling (should work now):</h3>
    <timeflow-card id="test-card-native"></timeflow-card>
    
    <h3>Test 3: Proportional scaling (small card):</h3>
    <timeflow-card id="test-card-small" style="width: 200px;"></timeflow-card>
    
    <h3>Test 4: Proportional scaling (large card):</h3>
    <timeflow-card id="test-card-large" style="width: 500px;"></timeflow-card>
    
    <h3>Expected Behavior:</h3>
    <ul>
      <li><strong>Card 1:</strong> Blue gradient, custom styling via card-mod</li>
      <li><strong>Card 2:</strong> Red title, green background via native styles</li>
      <li><strong>Card 3:</strong> Small card with proportionally sized elements</li>
      <li><strong>Card 4:</strong> Large card with proportionally sized elements</li>
    </ul>
  </div>

  <!-- Mock card-mod for testing -->
  <script>
    // Mock card-mod implementation for testing
    class MockCardMod extends HTMLElement {
      static applyToElement(element, type, config, variables, shadow, cls) {
        console.log('Card-mod applied:', { element, type, config, variables, shadow, cls });
        
        // Apply some basic styling to verify integration
        if (config && config.style) {
          const style = document.createElement('style');
          style.textContent = config.style;
          element.shadowRoot.appendChild(style);
          return true;
        }
        return false;
      }
    }
    
    customElements.define('card-mod', MockCardMod);
  </script>

  <!-- Load TimeFlow Card -->
  <script src="timeflow-card.js"></script>
  
  <script>
    // Test card-mod integration
    document.addEventListener('DOMContentLoaded', () => {
      const results = document.getElementById('test-results');
      const testCardMod = document.getElementById('test-card-mod');
      const testCardNative = document.getElementById('test-card-native');
      const testCardSmall = document.getElementById('test-card-small');
      const testCardLarge = document.getElementById('test-card-large');
      
      function addResult(test, pass, message) {
        const div = document.createElement('div');
        div.className = `test-result ${pass ? 'pass' : 'fail'}`;
        div.textContent = `${pass ? '✓' : '✗'} ${test}: ${message}`;
        results.appendChild(div);
      }
      
      // Test 1: Card-mod class exists
      const cardModExists = customElements.get('card-mod');
      addResult('Card-mod Mock', !!cardModExists, cardModExists ? 'Available' : 'Not found');
      
      // Test 2: Configure cards with different styling approaches
      const cardModConfig = {
        target_date: "2025-12-31T23:59:59",
        title: "Card-mod Test",
        card_mod: {
          style: `
            ha-card {
              background: linear-gradient(45deg, #1976d2, #42a5f5) !important;
              border: 2px solid #0d47a1 !important;
              border-radius: 20px !important;
              box-shadow: 0 4px 20px rgba(25, 118, 210, 0.3) !important;
            }
            .title {
              color: white !important;
              text-shadow: 1px 1px 2px rgba(0,0,0,0.5) !important;
            }
          `
        }
      };

      const nativeStyleConfig = {
        target_date: "2025-12-31T23:59:59",
        title: "Native Styles Test",
        background_color: "#4CAF50",
        styles: {
          title: ["color: #FF5722", "font-weight: bold"],
          subtitle: ["color: #FFC107"],
          card: ["border: 3px solid #FF9800"]
        }
      };

      const smallCardConfig = {
        target_date: "2025-12-31T23:59:59",
        title: "Small Card",
        width: "200px",
        height: "120px"
      };

      const largeCardConfig = {
        target_date: "2025-12-31T23:59:59",
        title: "Large Card",
        width: "500px",
        height: "250px"
      };
      
      try {
        // Configure all test cards
        testCardMod.setConfig(cardModConfig);
        testCardNative.setConfig(nativeStyleConfig);
        testCardSmall.setConfig(smallCardConfig);
        testCardLarge.setConfig(largeCardConfig);
        
        addResult('Card Configuration', true, 'All cards configured successfully');
        
        // Test 3: Check methods exist
        const hasCardModMethod = typeof testCardMod._applyCardMod === 'function';
        addResult('Card-mod Method', hasCardModMethod, hasCardModMethod ? 'Method exists' : 'Method missing');
        
        const hasNativeStyleMethod = typeof testCardNative._applyNativeStyles === 'function';
        addResult('Native Style Method', hasNativeStyleMethod, hasNativeStyleMethod ? 'Method exists' : 'Method missing');
        
        const hasProportionalMethod = typeof testCardSmall._calculateProportionalSizes === 'function';
        addResult('Proportional Sizing', hasProportionalMethod, hasProportionalMethod ? 'Method exists' : 'Method missing');
        
        // Test 4: Check if elements are created
        setTimeout(() => {
          const haCards = [testCardMod, testCardNative, testCardSmall, testCardLarge].map(
            card => card.shadowRoot.querySelector('ha-card')
          );
          const allHaveHaCard = haCards.every(card => !!card);
          addResult('ha-card Elements', allHaveHaCard, allHaveHaCard ? 'All created successfully' : 'Some missing');
          
          // Test 5: Check proportional scaling
          setTimeout(() => {
            const smallTitle = testCardSmall.shadowRoot.querySelector('.title');
            const largeTitle = testCardLarge.shadowRoot.querySelector('.title');
            
            if (smallTitle && largeTitle) {
              const smallFontSize = parseFloat(getComputedStyle(smallTitle).fontSize);
              const largeFontSize = parseFloat(getComputedStyle(largeTitle).fontSize);
              const isProportional = largeFontSize > smallFontSize;
              addResult('Proportional Fonts', isProportional, 
                isProportional ? `Small: ${smallFontSize}px, Large: ${largeFontSize}px` : 'Not scaling properly');
            }
          }, 100);
        }, 100);
        
      } catch (error) {
        addResult('Card Configuration', false, error.message);
      }
    });
  </script>
</body>
</html>
